
# JEE basics tutorial

This tutorial will take you through core concepts of Java EE and also touch on subjects like swagger, docker, and openshift. Just enought to spark your interest :)
The purpose of this exercise it to build a Java EE web application and in doing so, explore concepts like JPA, CDI, RESTful WebServices, external interfaces. The example application is following the CA 4.1 (Component Architecture 4.1) architecture from Adam Bien. 

## The web app

The app will publish some web services for populating and querying a move database. We will also be calling an external system (omdbapi.com) to retrieve some additional information for the movies (i.e. the plot, the movie poster, the genre, etc.).

## Prerequisites

In order to go through this tutorial you will need:
* [payara](https://www.payara.fish/software/downloads/) - Application Server
* [maven](https://maven.apache.org/download.cgi) - Dependency Management
* [JDK](https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) - JDK

Install everything and let's get to work.

## Steps

### Setting up the project

The first thing we need to do is to create a maven project for our application, and then start implementing it. The outcome of this step is a maven project with war packaging. We need to add some dependencies in order the access the JEE classes we will need further.

```
        <dependency>
            <groupId>javax</groupId>
            <artifactId>javaee-api</artifactId>
            <version>7.0</version>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>fish.payara.extras</groupId>
            <artifactId>payara-embedded-all</artifactId>
            <version>4.1.152.1</version>
            <scope>provided</scope>
        </dependency>
```
Note: as you can se the scope is set to provided; that is because the jars needed at runtime will alredy be provided in payara.

If you've done everything right you should run
```
mvn clean package
```
and find in the target subdir a war file.

Hints:
* [Maven in 5 minutes](https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html)
* [Maven webapp archetype](https://maven.apache.org/archetypes/maven-archetype-webapp)

### Creating the endpoint

The next exercise is to create one resource called "/movies". We want three actions on this resource: create a movie, get a list of all movies, get a movie by id.
The domain objects that we will work on are:

* movie -> title, cast (list of actors)
* actor -> fist name, last name, birth date

While implementing these we will keep a static list of movies. We will be introducing a database later. In the case of get by id, to keep things simple, we will think of the index in the list as the id.  

Hints:

* create classes for modelling the domain objects (Movie, Actor) 
* [http verbs](https://www.restapitutorial.com/lessons/httpmethods.html)  - HTTP verbs correspondence to CRUD operations
* [@Consumes](https://docs.oracle.com/cd/E19776-01/820-4867/ggqqr/index.html), [@Produces](https://docs.oracle.com/cd/E19776-01/820-4867/ghrns/index.html) - configure what the service's media type
* [JacksonFeature](https://cassiomolin.com/2016/08/10/using-jackson-as-json-provider-in-jersey-2x/) - using jackson for json serialization/deserialization
* [@JsonFormat](https://www.baeldung.com/jackson-jsonformat) - configuring how fields are formatted while serializing 

### JPA

Now we will be adding a databse to our little project. Glassfish comes with an embedded derby database, so out of convenience we will be using that, but our code should run on any other DB as long as we use JPA. 
If you want to start the DB you can use the command:
```
asadmin start-database
```
Add a persistence.xml file to be able to connect to the derby DB, and annotate the two entities (movie and actor) so that we could access the DB using them. The id of the entities will be autogenerated. 

Hints:
* the data source for the embedded database is ```jdbc/__default```
* [eclipselink.ddl-generation](https://www.eclipse.org/eclipselink/documentation/2.5/jpa/extensions/p_ddl_generation.htm) - use this to generate the DB at app startup (based on the JPA entities)
* [persistence.xml](https://thoughts-on-java.org/jpa-persistence-xml/) - used for database connection configuration
* [@Id](https://docs.oracle.com/javaee/7/api/javax/persistence/Id.html), [@GeneratedValue](https://docs.oracle.com/javaee/7/api/javax/persistence/GeneratedValue.html), [@OneToMany](https://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html)

### Persisting the data

Now that we introduced the DB, let's use it. Modify the creating and reading of the movies to use the DB to persist them.
In doing so you should extract this logic in a separate class (a controller) that would get injected in the resource class.

Hints:
* [EntityManager](https://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html)
* [@NamedQuery](https://docs.oracle.com/javaee/7/api/javax/persistence/NamedQuery.html)
* [@Inject](https://docs.oracle.com/javaee/7/api/javax/inject/Inject.html)
* [beans.xml](https://docs.oracle.com/javaee/6/tutorial/doc/gjbnz.html) - configuring a CDI application

### Validation

Let's add some validation to our entities. The last name and the birth date of the actor cannot be null. The same goes for the movie title.

Hints:
* [@NotNull](https://docs.oracle.com/javaee/7/api/javax/validation/constraints/NotNull.html)


### Adding some more features

Add some more functionality. We want to be able to also edit and delete a movie based on its id. Another *find* method would be nice to add as well: find by title. It would be nice if you could make the title accept wildcards (\*, ?). If not an exact match will suffice.

Hints:

* [@DELETE](https://docs.oracle.com/javaee/7/api/javax/ws/rs/DELETE.html)
* [@PUT](https://docs.oracle.com/javaee/7/api/javax/ws/rs/PUT.html)
* [@PathParam](https://docs.oracle.com/javaee/7/api/javax/ws/rs/PathParam.html)

### External service

At this step we will be adding an external system. We will use omdbapi.com. It's fairly easy to get a apikey. You just need to have an email address. We will be retrieving from the omdbapi service:
 
* the plot
* the genre
* the movie poster
* the imdb rating
* the imdb votes

We will use the title as query param for the external service. As a first step we will create a new endpoint (/title/{title}/exif) that gets this additional information and returns it to the caller. We do this intermediary step to make sure we are able to call the web service and that everything works fine, before integrating it with the rest of the app.
For your convenience there are some classes that help with calling an external REST service. You just need to extend the RestClient class, and configure 

### Integrating the external service

Now you must add a field to store this external data in the movie object. And in order to control the external service being called we will add a query param to the find by title method and use as a flag to control whether the external data will be included in the response or not (and whether the external service gets called or not). You should make this data not persist-able.

Hints:
* [@QueryParam](https://docs.oracle.com/javaee/7/api/javax/ws/rs/QueryParam.html)
* [@Transient](https://docs.oracle.com/javaee/7/api/javax/persistence/Transient.html)

## Next chapter

In the next tutorial we will cover:
* timers
* swagger
* docker
* openshift
